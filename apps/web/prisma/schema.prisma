generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserProfile {
  id                   String           @id @default(uuid())
  auth0Id              String           @unique
  email                String?
  name                 String?
  joinedAt             DateTime         @default(now())
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  dailyAnalysisLimit   Int              @default(5)
  lastResetDate        DateTime         @default(now())
  stripeCustomerId     String?          @unique
  stripeSubscriptionId String?          @unique
  subscriptionEndsAt   DateTime?
  subscriptionTier     String           @default("free")
  todayAnalysisCount   Int              @default(0)
  analyses             AnalysisRecord[]
  usageHistory         UsageHistory[]
}

model UsageHistory {
  id     String      @id @default(uuid())
  userId String
  date   DateTime    @default(now())
  count  Int         @default(0)
  user   UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
}

model AnalysisRecord {
  id                String      @id @default(uuid())
  userId            String
  url               String?
  title             String?
  trustScore        Float
  hasMisinformation Boolean
  flaggedTags       String
  analyzedAt        DateTime    @default(now())
  bias              String?
  user              UserProfile @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([analyzedAt])
}
